# MindWord

## 🎯 项目概述
MarkMind是一款基于思维导图的写作工具，通过思维导图的层级结构可视化操作，实现Markdown文本与可视化思维导图的双向同步编辑。
口号：像画图一样写文档。

### 功能亮点与解决问题
1. Markdown文本与可视化操作思维导图的双向同步编辑；—— 解决了传统思维导图绘制与文档正文编辑的脱节与不同步，实现画完即写完；
2. 支持AI生成子节点和节点描述； —— 解决了文章写作时如何嵌入特点子主题头脑风暴的问题。
3. 思维导图为结构化的多层级数据，涵盖markdown所有标题和多级列表结构作为节点，同时每个节点同时包含标题+正文（备注）； —— 开创多层级联动的写作方式，层次分明，让写作的逻辑可视化联动。
4. 对节点的移动操作，均会联动md的标题+正文内容以及所有子级； —— 解决传统markdown或文档工具移动时孤立操作的问题，让文章的组织和移动符合逻辑关系；
5. 支持导入导出含图片的markdown源文件； —— 密钥和文章等所有数据本地存储，无服务器，保证隐私，开源免费，可修改，可复用。
6. 以最终能输出层级分明的wrod文档为目标； —— 最终输出正式文件，真正实现可用。

---

## 📋 界面功能

### 顶部框架（全局功能）
- 左上角展示品牌名称。
- 中部3个tab可支持在下面打开多个子页面：可打开md编辑、md预览、思维导图三种视图，比例是1：1：2。（子页面地址先随便填，我后面自己改），可支持同时打开，也支持逐个收起，顺序固定。至少要保留显示一个。 
- 拖动三个视图中间的边框，可以调整相邻子页面视图的宽度。
- 一次最多编辑一个md文件。
- 专注模式开关：开启后变为单选模式，点谁才显示谁，其他的子页面隐藏。

### md编辑
- 按钮：
  - 【导出】：如果不包含图片，则只下载md文件。如果包含图片，则导出正在编辑的md和包含所有图片的zip压缩包。
  - 【上传】：支持上传 `.md/.zip` 文件并加载,zip里如果有图片和对应的引用则也要保证生效，之后只基于这个md文件进行编辑。
  - 【查看JSON】：调试用，支持随时查看md对应的json数据。
  - 【帮助】图标：悬浮查看支持的markdown格式、鼠标快捷方式以及支持的节点格式等帮助文档。默认展开，可点击收起。
- 编辑器：
  - 输入内容后，自动同步到预览区域和思维导图区域，且不打断输入。
  - 支持markdown语法，支持markdown扩展语法，如：emoji表情、图片、链接、表格、引用等。
  - 按ctrl+s ,会把markdown内容保存到localstorage并提示，下次进入页面时自动加载缓存内容，如果没有缓存才加载默认内容；
  - 支持添加图片（支持ctrl+v粘贴）
- 帮助内容：
```
快捷操作
点击节点：选中（高亮）
双击节点：编辑
Tab 添加子节点
Enter 添加同级节点
拖拽节点 / 框选 / Space+拖动画布
Ctrl + 滚轮：放大/缩小画布
删除节点：选中后按 Delete 或 Backspace

支持的Markdown格式:
节点类型:
# 标题
- 无序列表
1. 有序列表
非节点格式:
普通段落
**粗体**
*斜体*
`代码`
```

### md预览


#### 界面元素
- markdown样式预览：- 自动读取localstorage里的markdown内容并渲染样式显示在工具栏下方。支持预览md中的图片、链接、表情。
- 【下载word】按钮：支持导出应用了格式的word文档；
- 【下载模板】按钮：下载内置的一个word模板文件；
- 【上传模板】按钮：上传一个word模板文件，用于转换markdown的样式并生成有格式的word文档以便下载；
- 【选择模板】下拉框，可选择上传的自定义模板文件，默认选择【默认模板】；
- 

#### 测试流程
- 用户初次进入页面，markdown编辑器中自动加载示例数据
- 用户点击【下载word】按钮，系统根据项目目录下的"默认模板.docx"文件解析的样式+markdown编辑器中的文本内容，生成Word文档并下载
- 用户点击【下载模板】按钮，系统把项目目录下的默认模板.docx文件下载到本地
- 用户在自己的电脑上修改了word模板文件的模板样式，点击上传【上传模板】按钮，界面显示上传成功；
- 系统收到用户上传的自定义word模板，自动解析样式，并输出解析结果到控制台；
- 用户在【选择模板】下拉框中选择自己上传的模板名称
- 用户点击【下载word】按钮，系统根据用户上传的自定义word模板文件解析的样式+markdown编辑器中的文本内容，生成Word文档并下载


#### 功能要求

#####  **📁 word模板管理**
- 支持下载内置的默认模板
- 支持上传自定义模板
- 支持.docx格式文件，最大10MB
- 实时上传状态成功提示
- 用户上传的自定义word模板和解析样式数据存储在浏览器的localStorage中，下次打开可继续使用
- 支持选择模板生成word

#####  **🎨 word模板文档样式提取**
- 提取样式内容：字体、字号、字体颜色、对齐方式、缩进、标题层级、是否加粗、是否斜体、是否下划线、列表编号/符号样式
- 显示已成功提取样式数量统计
- 提取样式名称：标题1到标题6，有序列表，无序列表，正文，引用。每一个均对应markdown的语法，未匹配的markdown内容以正文样式渲染。


### 思维导图
- 支持实时渲染和操作节点，数据实时同步；
- 按钮：
  - 【查看JSON】：调试用，支持随时查看思维导图对应的json数据。
  - 【导出png】：导出包含完整思维导图所有节点的PNG图片。
- 控制显示：
  - 显示/隐藏非标题节点
  - 显示/隐藏节点类型标记（标题 / 列表）
  - 显示/隐藏节点备注
  - 右下角图标控制缩放：`+` 放大，`-` 缩小，`⟳` 重置。

- **节点渲染**

  每个节点分分为节点名称和节点备注两个矩形显示区域，如果没有备注则不显示备注区域。
  -  节点名称区域：
    - 用于展示节点的名称字段。分类两类：标题类节点和列表类节点。
    - 标题类节点：（`#` ~ `######`）作为标题类节点
    - 列表类节点：带层级（两个空格为一层）的无序序号和有序序号作为列表节点，支持区分父子级。在标题节点后到下个标题节点之间的最大列表节点层级，自动视为直属标题节点的下一级，其余子级跟随降级。
    - 节点名称如果文本过长，不截断，自动换行，直到显示完整名称。矩形高度、宽度、间距自适应。
    
  - 节点备注区域：
    - 如果当前节点没有备注内容，则不显示备注区域。
    - 附属信息包括非标题和列表的普通段落、表格、引用、图片等内容，也可理解为当前节点的正文或解释。
    - markdown的两个节点行之间的所有内容作为所直属的节点的备注内容，在思维导图中显示到紧贴节点名称的下方，可控制隐藏。
    - 思维导图的节点备注支持多行显示，默认最多显示3行，双击备注可在底部的大输入框中编辑保存备注。
    - 节点的上下间距适中，并且需要考虑备注的高度；

  - 通用支持显示内容：
    - 支持展示markdown中的emoji表情;
    - 支持展示markdown中的图片，均以30px的高度展示到备注中，点击可查看大图；
    - 支持展示markdown中的链接，点击可跳转；
    
- **添加节点**
  - 选中节点按下tab或者enter后可添加子级或同级节点。
  - 添加节点后，马上自动进入节点内联编辑状态；
  - 子节点类型：如果有兄弟节点，则兄弟节点类型，如果没有兄弟节点则取父节点类型，层级+1，。
	- 选中一个节点，显示【AI生成】图标，点击后，自动拼接当前节点关键信息，所有父级节点路径，所有直属兄弟节点，加入到AI提示词中，让AI生成指定层级和数量的子节点和孙子节点。生成后可先预览，再应用或放弃。

- **编辑节点**

  - 编辑名称（内联编辑）：
    - 双击或在单选节点时直接输入内容，进入编辑状态，修改节点的名称；
    - 修改节点名称时，显示内联编辑框，并自动调整画布位置，让正在编辑的节点显示到画布中心，输入框跟随节点位置号显示；
    - 在内联输入框输入完成后，点击空白处或者按下enter或tab，退出编辑状态，并且更新数据和另外两个视图。
    - 点击节点名称的emoji表情，可从表情库中快捷切换
  - 编辑备注（底部编辑框）：
    - 双击备注可在底部的大文本输入框中编辑保存备注。
    - 输入完成后，点击空白处或者按下enter或tab，退出编辑状态，并且更新数据和另外两个视图。
    - 支持AI根据节点上下文，辅助编写当前节点的备注内容；

- **移动节点**

  - 拖动选中的节点，可移动到不同父级下，或调整排序，移动时整棵子树跟随所选父级。
  - 拖拽时实时显示半透明显示选中节点跟随鼠标，并且实时指示插入位置（高亮目标父节点，并红横线在兄弟节点之间表示插入位置）。
  - 支持框选多个节点后批量移动，批量选择。拖动后，选中的多个节点内部相对层级不变。
  - 节点可移动到任意非后代节点（避免循环嵌套）。

- **键鼠操作一览**

  - 单击节点：仅选中当前节点（高亮），悬浮【AI生成】的图标。选中状态下如果键盘有输入内容，进入内联编辑模式。
  - 单击空白画布：取消选中所有节点，如果当前正在内联编辑模式，保存并退出。
  - 鼠标在空白画布上拖拽：框选多个节点。如果选到了父级，视为按最高层级的节点选择，并自动选中所有子级。不可同时框选属于不同父级节点的子节点。--？存疑
  - 按下空格(space) + 鼠标在空白画布上拖拽：移动整个画布，调整导图位置。
  - 点击节点右侧的收起/展开按钮：可收起/展开所有子级节点；
  - 双击节点：进入节点编辑模式（内联编辑）；
  - 双击备注框：在底部的大输入框中修改备注；
  - `Tab`：添加子节点。
  - `Enter`：添加同级节点。
  - `Delete`：删除所有选中节点及子树。
  - `ctrl+z`：恢复上一步操作，最多恢复到30步以前。
  - `ctrl+shift+z`： 重做撤销的动作。
  - `ctrl+s`：保存当前数据到localstorage并提示，下次进入页面时自动加载缓存内容，如果没有缓存才加载默认内容。
  - 自动定位：每次新增或者修改节点时，画布都自动移动到以新增节点为中心的位置。
  - 支持emoji：选中节点时支持从表情库中添加emoji表情到节点内的文字前面，表情库至少需要包含进度相关的emoji。
  - 新增规则：在无序序号下添加子级时，子节点也要是下一层级的无序序号；有序序号同理；
  - 鼠标滚轮：上下滑动滚动条；
  - ctrl+鼠标滚轮：放大缩小显示比例；

  ### AI生成
- AI配置
  - 点击顶部的【AI配置】按钮，弹窗可选择供应商（至少包含openrouter），输入API密钥，快捷打开对应供应商网站链接获取密钥，模型选择。
  - 至少支持选择openrouter的以下模型：
    { id: 'deepseek/deepseek-chat-v3.1:free', name: 'deepseek/deepseek-chat-v3.1:free', description: 'deepseek v3.1' },
    { id: 'openai/gpt-oss-120b:free', name: 'gpt-oss-120b', description: '' },
    { id: 'openai/gpt-oss-20b:free', name: 'gpt-oss-20b', description: '' },
    { id: 'google/gemini-2.0-flash-exp:free', name: 'gemini-2.0-flash', description: '' },
    { id: 'google/gemini-2.5-pro-exp-03-25', name: 'gemini-2.5-pro', description: '' },
  - 可配置提示词模板，提供内置参数（当前节点关键信息，所有父级节点路径，所有直属兄弟节点）以供编辑提示词时插入，并保存到本地，下次进入时不用重复配置。
- AI生成
  - 选中一个节点，显示【AI生成】按钮，点击后，自动拼接当前节点关键信息，所有父级节点路径，所有直属兄弟节点，加入到AI提示词中，让AI生成指定层级和数量的子节点和孙子节点。
  - 生成后可先预览，再应用或放弃。