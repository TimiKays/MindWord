<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>本地jsmind测试</title>
    <link type="text/css" rel="stylesheet" href="jsmind.css" />
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #jsmind_container {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
            background: #f8f8f8;
        }
        .controls {
            margin-bottom: 20px;
        }
        .controls button {
            margin-right: 10px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .controls button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>本地jsmind测试页面</h1>
    <div class="controls">
        <button onclick="add_node()">添加节点</button>
        <button onclick="edit_node()">编辑节点</button>
        <button onclick="remove_node()">删除节点</button>
        <button onclick="expand_all()">展开全部</button>
        <button onclick="collapse_all()">收起全部</button>
    </div>
    <div id="jsmind_container"></div>

    <script src="jsmind.js"></script>
    <script src="jsmind.draggable-node.js"></script>
    <script>
        var mind = {
            "meta": {
                "name": "测试思维导图",
                "author": "test",
                "version": "1.0"
            },
            "format": "node_array",
            "data": [
                {"id": "root", "isroot": true, "topic": "根节点"},
                {"id": "node1", "parentid": "root", "topic": "子节点1"},
                {"id": "node2", "parentid": "root", "topic": "子节点2"},
                {"id": "node3", "parentid": "node1", "topic": "子节点1.1"},
                {"id": "node4", "parentid": "node1", "topic": "子节点1.2"},
                {"id": "node5", "parentid": "node2", "topic": "子节点2.1"}
            ]
        };

        var options = {
            container: 'jsmind_container',
            editable: true,
            theme: 'primary',
            mode: 'full',
            support_html: true,
            view: {
                engine: 'canvas',
                hmargin: 100,
                vmargin: 50,
                line_width: 2,
                line_color: '#555'
            },
            layout: {
                hspace: 30,
                vspace: 20,
                pspace: 13
            },
            shortcut: {
                enable: true,
                handles: {},
                mapping: {
                    addchild: 45,
                    addbrother: 13,
                    editnode: 113,
                    delnode: 46,
                    toggle: 32,
                    left: 37,
                    up: 38,
                    right: 39,
                    down: 40
                }
            }
        };

        var jm = new jsMind(options);
        jm.show(mind);

        function add_node() {
            var selected_node = jm.get_selected_node();
            if (!selected_node) {
                alert('请先选择一个节点');
                return;
            }
            var nodeid = jsMind.util.uuid.newid();
            var topic = '新节点_' + nodeid.substr(0, 5);
            jm.add_node(selected_node, nodeid, topic);
        }

        function edit_node() {
            var selected_node = jm.get_selected_node();
            if (!selected_node) {
                alert('请先选择一个节点');
                return;
            }
            var new_topic = prompt('输入新的节点内容:', selected_node.topic);
            if (new_topic !== null && new_topic !== '') {
                jm.update_node(selected_node.id, new_topic);
            }
        }

        function remove_node() {
            var selected_node = jm.get_selected_node();
            if (!selected_node) {
                alert('请先选择一个节点');
                return;
            }
            if (selected_node.isroot) {
                alert('不能删除根节点');
                return;
            }
            if (confirm('确定要删除选中的节点吗?')) {
                jm.remove_node(selected_node.id);
            }
        }

        function expand_all() {
            jm.expand_all();
        }

        function collapse_all() {
            jm.collapse_all();
        }
    </script>
</body>
</html>