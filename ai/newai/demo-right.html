<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <title>Demo Right - 直接获取回应示例（no modal）</title>
    <style>
        body {
            font-family: system-ui, Arial, sans-serif;
            padding: 12px
        }

        textarea {
            width: 100%;
            height: 120px;
            padding: 8px
        }

        button {
            margin-top: 8px;
            padding: 6px 10px
        }

        .result {
            margin-top: 12px;
            padding: 8px;
            border: 1px solid #eee;
            background: #fff
        }
    </style>
</head>

<body>
    <h4>右侧：直接获取回应（不弹窗）</h4>
    <p>示例将发送一个直接模式请求（mode:'direct'），结果在下方显示。</p>

    <label>输入（将作为 single param）：
        <input id="value" placeholder="要发送的值" style="width:100%;padding:6px">
    </label>
    <button id="send">发送（direct）</button>

    <div class="result"><strong>响应：</strong>
        <pre id="out">（空）</pre>
    </div>

    <script>
        function genId() { return 'r_' + Math.random().toString(36).slice(2, 10); }

        document.getElementById('send').addEventListener('click', () => {
            const value = document.getElementById('value').value || '默认值';
            const requestId = genId();
            function onMsg(e) {
                try {
                    const msg = e.data;
                    if (!msg || msg.requestId !== requestId) return;
                    if (msg.type === 'AI_MODAL_RESULT') {
                        document.getElementById('out').textContent = JSON.stringify(msg.detail, null, 2);
                        window.removeEventListener('message', onMsg);
                    }
                } catch (_) { }
            }
            window.addEventListener('message', onMsg, false);

            const payload = { mode: 'direct', params: { input: { desc: '右侧输入', value } } };
            window.parent.postMessage({ type: 'AI_MODAL_OPEN_REQUEST', requestId, payload }, '*');
        });
    </script>
</body>

</html>