<!DOCTYPE html>
<html>
<head>
    <title>占位符测试</title>
</head>
<body>
    <h1>测试占位符传递</h1>
    <input type="text" id="topicInput" placeholder="输入主题">
    <button onclick="testAI()">测试AI生成</button>
    <div id="result"></div>

    <script>
        // 监听消息
        window.addEventListener('message', function(event) {
            console.log('收到消息:', event.data);
            document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(event.data, null, 2) + '</pre>';
        });

        function testAI() {
            const topic = document.getElementById('topicInput').value || '测试主题';
            
            // 模拟aiGenerateInitialTreeMini的行为
            const placeholders = {
                name: { desc: '初始主题', value: topic }
            };
            
            const payload = {
                actionType: 'generate_initial_tree',
                templateKey: 'mindmap_initial',
                title: '生成初始树',
                initialView: 'mini',
                miniPrompt: '请输入中心主题',
                placeholders: placeholders,
                params: placeholders, // 兼容AIServiceModal.html
                autoRun: false
            };

            // 模拟发送消息
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'AI_MODAL_OPEN',
                    actionType: payload.actionType,
                    requestId: 'test_' + Date.now(),
                    payload: payload
                }, '*');
            } else {
                // 直接显示payload
                document.getElementById('result').innerHTML = '<h3>发送的payload:</h3><pre>' + JSON.stringify(payload, null, 2) + '</pre>';
            }
        }

        // 页面加载后自动测试
        window.onload = function() {
            document.getElementById('topicInput').value = 'AI制作动画平台';
            setTimeout(testAI, 1000);
        };
    </script>
</body>
</html>